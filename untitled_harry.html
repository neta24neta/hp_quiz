<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultimate Harry Potter Sorting Quiz</title>
<style>
body { font-family: 'Georgia', serif; background: #f4f4f4; color: #222; margin: 0; padding: 0;}
.container { width: 90%; max-width: 900px; margin: auto; padding: 20px;}
.question { margin-bottom: 20px; padding: 15px; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
.option { margin: 5px 0;}
button { padding: 10px 20px; margin-top: 10px; cursor: pointer; }
.results { margin-top: 30px; padding: 20px; background: #eee; border-radius: 10px;}
.alignment-map { margin-top:20px; width:300px; height:300px; border:1px solid #333; position:relative; background:#fff;}
.dot { width:15px; height:15px; border-radius:50%; position:absolute; background:red; cursor:pointer;}
.tooltip { position:absolute; background:#333; color:#fff; padding:5px; border-radius:5px; font-size:12px; display:none;}
</style>
</head>
<body>

<div class="container">
<h1>Ultimate Harry Potter Sorting Quiz</h1>
<div id="quiz"></div>
<div id="results" class="results" style="display:none;"></div>
<div class="tooltip" id="tooltip"></div>
</div>

<script>
// Minimal dataset example for demonstration; fill in all 30 questions similarly
const quizData = [
  {
    question: "Which activity excites you most at Hogwarts?",
    options: ["Exploring dangerous areas","Helping classmates","Studying and researching","Planning clever strategies"],
    points: [
      {gryff:2,huff:0,raven:1,slyth:0,pure:0,half:1,muggle:2,trait:['Adventurous'],companion:['Daring'],align:{x:2,y:1},book:['Goblet']},
      {gryff:0,huff:2,raven:1,slyth:0,pure:1,half:2,muggle:1,trait:['Helpful'],companion:['Loyal'],align:{x:0,y:2},book:['Philosopher']},
      {gryff:0,huff:1,raven:2,slyth:0,pure:2,half:1,muggle:0,trait:['Studious'],companion:['Thoughtful'],align:{x:1,y:2},book:['Prisoner']},
      {gryff:1,huff:0,raven:0,slyth:2,pure:1,half:1,muggle:1,trait:['Clever'],companion:['Mischievous'],align:{x:2,y:0},book:['Half-Blood']}
    ]
  },
  {
    question: "Have you ever hidden something from your family because you feared disappointing them? (heart-opener #1)",
    options: ["Never","Rarely","Sometimes","Often","Always"],
    points: [
      {gryff:0,huff:0,raven:1,slyth:2,pure:0,half:1,muggle:2,trait:['Cautious'],companion:[],align:{x:1,y:0},book:['Philosopher']},
      {gryff:0,huff:1,raven:1,slyth:1,pure:1,half:1,muggle:1,trait:['Reflective'],companion:[],align:{x:1,y:1},book:['Prisoner']},
      {gryff:1,huff:1,raven:2,slyth:1,pure:1,half:2,muggle:1,trait:['Secretive'],companion:[],align:{x:1,y:1},book:['Chamber']},
      {gryff:1,huff:2,raven:1,slyth:2,pure:2,half:2,muggle:0,trait:['Anxious'],companion:[],align:{x:2,y:1},book:['Order']},
      {gryff:2,huff:2,raven:1,slyth:1,pure:2,half:1,muggle:0,trait:['Guarded'],companion:[],align:{x:2,y:0},book:['Half-Blood']}
    ]
  }
  // Add remaining 28 questions with similar structure
];

// State
let current = 0;
let scores = {gryff:0,huff:0,raven:0,slyth:0,pure:0,half:0,muggle:0,trait:{},companion:{},align:{x:0,y:0},book:{}};

// Initialize trait, companion, book counts
function initScores() { ['trait','companion','book'].forEach(k=>{scores[k]={};}); scores.align={x:0,y:0}; }

// Render question
function renderQuestion() {
  const quiz = document.getElementById('quiz');
  if(current >= quizData.length) { showResults(); return; }
  const q = quizData[current];
  let html = `<div class="question"><h2>Question ${current+1}: ${q.question}</h2>`;
  q.options.forEach((opt,i)=>{
    html += `<div class="option"><button onclick="selectAnswer(${i})">${opt}</button></div>`;
  });
  html += `</div>`;
  quiz.innerHTML = html;
}

// Handle answer selection
function selectAnswer(optIndex){
  const points = quizData[current].points[optIndex];
  ['gryff','huff','raven','slyth','pure','half','muggle'].forEach(k=>{scores[k]+=points[k];});
  ['trait','companion','book'].forEach(k=>{
    points[k].forEach(p=>{scores[k][p] = (scores[k][p]||0)+1;});
  });
  // Alignment map scoring
  scores.align.x += points.align.x;
  scores.align.y += points.align.y;
  current++;
  renderQuestion();
}

// Show results
function showResults(){
  document.getElementById('quiz').style.display='none';
  const res = document.getElementById('results');

  // Highest scoring house
  const house = ['gryff','huff','raven','slyth'].reduce((a,b)=>scores[b]>scores[a]?b:a,'gryff');
  const blood = ['pure','half','muggle'].reduce((a,b)=>scores[b]>scores[a]?b:a,'half');
  const trait = Object.keys(scores.trait).reduce((a,b)=>scores.trait[b]>scores.trait[a]?b:a,'None');
  const companion = Object.keys(scores.companion).sort((a,b)=>scores.companion[b]-scores.companion[a]).slice(0,3).join(', ');
  const book = Object.keys(scores.book).reduce((a,b)=>scores.book[b]>scores.book[a]?b:a,'Philosopher');

  // Alignment calculation
  const alignX = Math.min(Math.max(scores.align.x,0),300);
  const alignY = Math.min(Math.max(scores.align.y,0),300);

  let html = `<h2>Your Results:</h2>
  <p><strong>House:</strong> ${house}</p>
  <p><strong>Blood Status:</strong> ${blood}</p>
  <p><strong>Dominant Trait:</strong> ${trait}</p>
  <p><strong>Top 3 Companions:</strong> ${companion}</p>
  <p><strong>Most Likely Book Feature:</strong> ${book}</p>
  <p><strong>Alignment:</strong></p>
  <div class="alignment-map" id="alignMap">
    <div class="dot" id="dot" style="top:${300-alignY}px; left:${alignX}px;"></div>
  </div>`;

  res.innerHTML = html;
  res.style.display='block';

  // Tooltip for alignment map
  const tooltip = document.getElementById('tooltip');
  const map = document.getElementById('alignMap');
  map.addEventListener('mousemove', e=>{
    const rect = map.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    let h = '';
    if(x<150) h+='Lawful '; else h+='Chaotic ';
    if(y<150) h+='Good'; else h+='Self-focused';
    tooltip.style.left = (e.pageX+10)+'px';
    tooltip.style.top = (e.pageY+10)+'px';
    tooltip.innerHTML = h;
    tooltip.style.display = 'block';
  });
  map.addEventListener('mouseleave', ()=>{tooltip.style.display='none';});
}

initScores();
renderQuestion();
</script>
</body>
</html>